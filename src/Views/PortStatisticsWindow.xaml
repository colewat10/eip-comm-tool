<Window x:Class="EtherNetIPTool.Views.PortStatisticsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:EtherNetIPTool.ViewModels"
        Title="{Binding WindowTitle}"
        Height="700"
        Width="900"
        WindowStartupLocation="CenterOwner"
        Background="#F0F0F0"
        FontFamily="Segoe UI"
        FontSize="10pt"
        ShowInTaskbar="False">

    <Window.Resources>
        <!-- Boolean to Visibility Converter -->
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>

        <!-- Inverse Boolean to Visibility Converter -->
        <Style x:Key="InverseVisibilityStyle" TargetType="Border">
            <Setter Property="Visibility" Value="Collapsed"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding SupportsDetailedErrors}" Value="False">
                    <Setter Property="Visibility" Value="Visible"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <DockPanel>
        <!-- Bottom Button Panel -->
        <Border DockPanel.Dock="Bottom" Background="#E8E8E8" BorderBrush="#D0D0D0" BorderThickness="0,1,0,0" Padding="10">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Content="Refresh Now"
                        Command="{Binding RefreshNowCommand}"
                        Width="100" Height="24" Margin="0,0,5,0"
                        ToolTip="Manually refresh port statistics"/>
                <Button Content="Close"
                        Command="{Binding CloseCommand}"
                        CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"
                        Width="100" Height="24"
                        IsDefault="True"/>
            </StackPanel>
        </Border>

        <!-- Main Content Area -->
        <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="10">
            <StackPanel>
                <!-- Header Section -->
                <Border Background="White" BorderBrush="#D0D0D0" BorderThickness="1" Padding="15" Margin="0,0,0,10">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Network Port Statistics" FontSize="16pt" FontWeight="Bold" Margin="0,0,0,5"/>
                            <TextBlock Text="{Binding WindowTitle}" FontSize="10pt" Foreground="#666"/>
                        </StackPanel>

                        <StackPanel Grid.Column="1" HorizontalAlignment="Right">
                            <TextBlock Text="Auto-Refresh" FontWeight="SemiBold" Margin="0,0,0,3"/>
                            <CheckBox Content="Enabled" IsChecked="{Binding AutoRefreshEnabled}" Margin="0,0,0,5"/>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Interval:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                <TextBox Text="{Binding RefreshIntervalSeconds, UpdateSourceTrigger=PropertyChanged}"
                                         Width="40" Height="22"/>
                                <TextBlock Text="sec" VerticalAlignment="Center" Margin="5,0,0,0"/>
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Link Status Section -->
                <Border Background="White" BorderBrush="#D0D0D0" BorderThickness="1" Padding="15" Margin="0,0,0,10">
                    <StackPanel>
                        <TextBlock Text="Link Status" FontSize="12pt" FontWeight="Bold" Margin="0,0,0,10"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="150"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="150"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="30"/>
                                <RowDefinition Height="30"/>
                                <RowDefinition Height="30"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Link Status:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding LinkStatus}" VerticalAlignment="Center" FontFamily="Consolas"/>

                            <TextBlock Grid.Row="0" Grid.Column="2" Text="Link Speed:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            <TextBlock Grid.Row="0" Grid.Column="3" Text="{Binding LinkSpeed}" VerticalAlignment="Center" FontFamily="Consolas"/>

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Duplex Mode:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding Duplex}" VerticalAlignment="Center" FontFamily="Consolas"/>

                            <TextBlock Grid.Row="1" Grid.Column="2" Text="Last Updated:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            <TextBlock Grid.Row="1" Grid.Column="3" Text="{Binding LastUpdated}" VerticalAlignment="Center" FontFamily="Consolas"/>

                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Data Source:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding DataSource}" VerticalAlignment="Center" FontFamily="Consolas" FontWeight="Bold" Foreground="#0066CC"/>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Traffic Counters Section -->
                <Border Background="White" BorderBrush="#D0D0D0" BorderThickness="1" Padding="15" Margin="0,0,0,10">
                    <StackPanel>
                        <TextBlock Text="Traffic Counters" FontSize="12pt" FontWeight="Bold" Margin="0,0,0,10"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="150"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="150"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="30"/>
                                <RowDefinition Height="30"/>
                                <RowDefinition Height="30"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Packets In:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding PacketsIn}" VerticalAlignment="Center"
                                       FontFamily="Consolas" FontSize="11pt"/>

                            <TextBlock Grid.Row="0" Grid.Column="2" Text="Packets Out:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            <TextBlock Grid.Row="0" Grid.Column="3" Text="{Binding PacketsOut}" VerticalAlignment="Center"
                                       FontFamily="Consolas" FontSize="11pt"/>

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Bytes In:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding BytesIn}" VerticalAlignment="Center"
                                       FontFamily="Consolas" FontSize="11pt"/>

                            <TextBlock Grid.Row="1" Grid.Column="2" Text="Bytes Out:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            <TextBlock Grid.Row="1" Grid.Column="3" Text="{Binding BytesOut}" VerticalAlignment="Center"
                                       FontFamily="Consolas" FontSize="11pt"/>

                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Multicast In:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding MulticastIn}" VerticalAlignment="Center" FontFamily="Consolas"/>

                            <TextBlock Grid.Row="2" Grid.Column="2" Text="Multicast Out:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            <TextBlock Grid.Row="2" Grid.Column="3" Text="{Binding MulticastOut}" VerticalAlignment="Center" FontFamily="Consolas"/>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Error Counters Section -->
                <Border Background="White" BorderBrush="#D0D0D0" BorderThickness="1" Padding="15" Margin="0,0,0,10">
                    <StackPanel>
                        <TextBlock Text="Error &amp; Discard Counters" FontSize="12pt" FontWeight="Bold" Margin="0,0,0,10"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="150"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="150"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="30"/>
                                <RowDefinition Height="30"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Errors In:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding ErrorsIn}" VerticalAlignment="Center"
                                       FontFamily="Consolas" Foreground="#CC0000"/>

                            <TextBlock Grid.Row="0" Grid.Column="2" Text="Errors Out:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            <TextBlock Grid.Row="0" Grid.Column="3" Text="{Binding ErrorsOut}" VerticalAlignment="Center"
                                       FontFamily="Consolas" Foreground="#CC0000"/>

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Discards In:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding DiscardsIn}" VerticalAlignment="Center"
                                       FontFamily="Consolas" Foreground="#FF8C00"/>

                            <TextBlock Grid.Row="1" Grid.Column="2" Text="Discards Out:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            <TextBlock Grid.Row="1" Grid.Column="3" Text="{Binding DiscardsOut}" VerticalAlignment="Center"
                                       FontFamily="Consolas" Foreground="#FF8C00"/>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Physical Layer Errors Section (Attribute 12) -->
                <Border Background="White" BorderBrush="#D0D0D0" BorderThickness="1" Padding="15" Margin="0,0,0,10"
                        Visibility="{Binding SupportsDetailedErrors, Converter={StaticResource BoolToVisibilityConverter}}">
                    <StackPanel>
                        <TextBlock Text="Physical Layer Errors (Layer 1)" FontSize="12pt" FontWeight="Bold" Margin="0,0,0,10"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="180"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="180"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="30"/>
                                <RowDefinition Height="30"/>
                                <RowDefinition Height="30"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="FCS Errors:" FontWeight="SemiBold" VerticalAlignment="Center"
                                       ToolTip="Frame Check Sequence errors - bad CRC"/>
                            <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding FCSErrors}" VerticalAlignment="Center"
                                       FontFamily="Consolas" FontSize="11pt" Foreground="#CC0000"/>

                            <TextBlock Grid.Row="0" Grid.Column="2" Text="Alignment Errors:" FontWeight="SemiBold" VerticalAlignment="Center"
                                       ToolTip="Frames not ending on byte boundary"/>
                            <TextBlock Grid.Row="0" Grid.Column="3" Text="{Binding AlignmentErrors}" VerticalAlignment="Center"
                                       FontFamily="Consolas" FontSize="11pt" Foreground="#CC0000"/>

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Frame Too Long:" FontWeight="SemiBold" VerticalAlignment="Center"
                                       ToolTip="Frames exceeding maximum size"/>
                            <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding FrameTooLongErrors}" VerticalAlignment="Center"
                                       FontFamily="Consolas" Foreground="#CC0000"/>

                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Total Physical Errors:" FontWeight="Bold" VerticalAlignment="Center"
                                       ToolTip="Sum of all physical layer errors"/>
                            <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding TotalPhysicalErrors}" VerticalAlignment="Center"
                                       FontFamily="Consolas" FontSize="12pt" FontWeight="Bold" Foreground="#CC0000"/>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Collision Counters Section (Attribute 12) -->
                <Border Background="White" BorderBrush="#D0D0D0" BorderThickness="1" Padding="15" Margin="0,0,0,10"
                        Visibility="{Binding SupportsDetailedErrors, Converter={StaticResource BoolToVisibilityConverter}}">
                    <StackPanel>
                        <TextBlock Text="Collision Counters (Half-Duplex)" FontSize="12pt" FontWeight="Bold" Margin="0,0,0,10"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="180"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="180"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="30"/>
                                <RowDefinition Height="30"/>
                                <RowDefinition Height="30"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Single Collisions:" FontWeight="SemiBold" VerticalAlignment="Center"
                                       ToolTip="Frames with exactly 1 collision"/>
                            <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding SingleCollisions}" VerticalAlignment="Center"
                                       FontFamily="Consolas" Foreground="#FF8C00"/>

                            <TextBlock Grid.Row="0" Grid.Column="2" Text="Multiple Collisions:" FontWeight="SemiBold" VerticalAlignment="Center"
                                       ToolTip="Frames with 2-15 collisions"/>
                            <TextBlock Grid.Row="0" Grid.Column="3" Text="{Binding MultipleCollisions}" VerticalAlignment="Center"
                                       FontFamily="Consolas" Foreground="#FF8C00"/>

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Late Collisions:" FontWeight="SemiBold" VerticalAlignment="Center"
                                       ToolTip="Collisions after 512 bit times - cable too long"/>
                            <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding LateCollisions}" VerticalAlignment="Center"
                                       FontFamily="Consolas" Foreground="#CC0000"/>

                            <TextBlock Grid.Row="1" Grid.Column="2" Text="Excessive Collisions:" FontWeight="SemiBold" VerticalAlignment="Center"
                                       ToolTip="Frames dropped after 16 collision attempts"/>
                            <TextBlock Grid.Row="1" Grid.Column="3" Text="{Binding ExcessiveCollisions}" VerticalAlignment="Center"
                                       FontFamily="Consolas" Foreground="#CC0000"/>

                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Total Collisions:" FontWeight="Bold" VerticalAlignment="Center"/>
                            <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding TotalCollisions}" VerticalAlignment="Center"
                                       FontFamily="Consolas" FontSize="12pt" FontWeight="Bold" Foreground="#FF8C00"/>

                            <TextBlock Grid.Row="2" Grid.Column="2" Text="Deferred TX:" FontWeight="SemiBold" VerticalAlignment="Center"
                                       ToolTip="Transmissions delayed due to medium busy"/>
                            <TextBlock Grid.Row="2" Grid.Column="3" Text="{Binding DeferredTransmissions}" VerticalAlignment="Center"
                                       FontFamily="Consolas" Foreground="#666666"/>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- MAC Layer Errors Section (Attribute 12) -->
                <Border Background="White" BorderBrush="#D0D0D0" BorderThickness="1" Padding="15" Margin="0,0,0,10"
                        Visibility="{Binding SupportsDetailedErrors, Converter={StaticResource BoolToVisibilityConverter}}">
                    <StackPanel>
                        <TextBlock Text="MAC Layer Errors (Layer 2)" FontSize="12pt" FontWeight="Bold" Margin="0,0,0,10"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="180"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="180"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="30"/>
                                <RowDefinition Height="30"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="MAC TX Errors:" FontWeight="SemiBold" VerticalAlignment="Center"
                                       ToolTip="Internal MAC sublayer transmit errors"/>
                            <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding MACTransmitErrors}" VerticalAlignment="Center"
                                       FontFamily="Consolas" Foreground="#CC0000"/>

                            <TextBlock Grid.Row="0" Grid.Column="2" Text="MAC RX Errors:" FontWeight="SemiBold" VerticalAlignment="Center"
                                       ToolTip="Internal MAC sublayer receive errors"/>
                            <TextBlock Grid.Row="0" Grid.Column="3" Text="{Binding MACReceiveErrors}" VerticalAlignment="Center"
                                       FontFamily="Consolas" Foreground="#CC0000"/>

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Carrier Sense Errors:" FontWeight="SemiBold" VerticalAlignment="Center"
                                       ToolTip="Carrier sense signal lost or never asserted"/>
                            <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding CarrierSenseErrors}" VerticalAlignment="Center"
                                       FontFamily="Consolas" Foreground="#CC0000"/>

                            <TextBlock Grid.Row="1" Grid.Column="2" Text="Total MAC Errors:" FontWeight="Bold" VerticalAlignment="Center"/>
                            <TextBlock Grid.Row="1" Grid.Column="3" Text="{Binding TotalMACErrors}" VerticalAlignment="Center"
                                       FontFamily="Consolas" FontSize="12pt" FontWeight="Bold" Foreground="#CC0000"/>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Critical Errors Summary (Attribute 12) -->
                <Border Background="#FFEBEE" BorderBrush="#CC0000" BorderThickness="2" Padding="15" Margin="0,0,0,10"
                        Visibility="{Binding SupportsDetailedErrors, Converter={StaticResource BoolToVisibilityConverter}}">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="⚠ Critical Errors: " FontSize="12pt" FontWeight="Bold" VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding CriticalErrors}" FontSize="14pt" FontWeight="Bold" Foreground="#CC0000"
                                   FontFamily="Consolas" VerticalAlignment="Center" Margin="10,0,0,0"
                                   ToolTip="FCS + Alignment + Excessive Collisions + Late Collisions"/>
                        <TextBlock Text="(FCS + Alignment + Excessive/Late Collisions)" FontStyle="Italic" Foreground="#666"
                                   VerticalAlignment="Center" Margin="10,0,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Warning for devices that don't support Attribute 12 -->
                <Border Style="{StaticResource InverseVisibilityStyle}"
                        Background="#FFF9E6" BorderBrush="#FFD700" BorderThickness="1" Padding="10" Margin="0,0,0,10">
                    <StackPanel>
                        <TextBlock Text="ℹ Detailed error counters not available" FontWeight="SemiBold" Margin="0,0,0,5"/>
                        <TextBlock Text="This device does not support Ethernet Link Object Attribute 12 (Interface Counters). Only general error totals are available."
                                   TextWrapping="Wrap" Foreground="#666"/>
                    </StackPanel>
                </Border>

                <!-- Refreshing Indicator -->
                <Border Background="#FFF9E6" BorderBrush="#FFD700" BorderThickness="1" Padding="10"
                        Visibility="{Binding IsRefreshing, Converter={StaticResource BoolToVisibilityConverter}}">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="⟳ Refreshing statistics..." FontStyle="Italic"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>
    </DockPanel>
</Window>
